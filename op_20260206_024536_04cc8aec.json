{
  "author": {
    "email": "brunosmmm@gmail.com",
    "name": "Bruno Morais"
  },
  "data": {
    "branch": "master",
    "content": "# Comprehensive Codebase Audit - hdltools\n\n## Audit Methodology\n10 independent specialist agents audited the codebase simultaneously, each focused on a different domain:\n1. Software Architecture, 2. Hardware Engineering, 3. DSL Design, 4. Test Engineering, 5. Error Handling, 6. API Design, 7. Performance, 8. Security, 9. Code Generation Backends, 10. DevOps/Packaging\n\n## Top Critical Findings (Cross-Agent Consensus)\n\n### 1. SECURITY: eval() and pickle.load() usage\n- `interface.py:77` and `mmap/builder.py:224`: Raw `eval()` on user expressions\n- `tools/vcdevts/__init__.py:157` and `vcd/parser.py:194`: `pickle.load()` on untrusted files\n- Both allow arbitrary code execution\n\n### 2. PACKAGING: Broken setup.py + missing package_data in pyproject.toml\n- setup.py references nonexistent scripts directory, is incompatible with pyproject.toml\n- TextX grammar files (.tx) not declared in pyproject.toml \u2192 broken installs\n- Version inconsistency (0.1 vs 0.1.0)\n- `dictator` dependency pinned to floating `master` branch\n\n### 3. ERROR HANDLING: 7 bare except clauses\n- verilog/codegen.py:33,94, abshdl/concat.py:119, highlvl.py:149, mmap/builder.py:404, sim/__init__.py:59, vcd/pattern.py:94\n- All silently swallow exceptions, making debugging extremely difficult\n\n### 4. ARCHITECTURE: Circular dependency abshdl \u2194 hdllib\n- abshdl/highlvl.py imports from hdllib.patterns and hdllib.fsm\n- hdllib imports from abshdl, creating circular dependency\n- 50+ duplicated methods between Verilog/VHDL backends\n\n### 5. HDL SEMANTICS: vector.py dumps() bug + assignment type issues\n- vector.py:135 dumps() returns `repr(eval_scope)` instead of vector string\n- Signal assignment type determination may be inverted for var type\n- VHDL codegen has hardcoded signal name 'counter_reg' (line ~440)\n\n### 6. TESTING: Major coverage gaps\n- No tests for binutils, docgen, latex, vecgen (minimal), sim/hdl.py compiler\n- No pytest configuration in pyproject.toml\n- No CI/CD pipeline\n- tests.sh uses fragile `$(which pytest)` invocation\n\n### 7. API DESIGN: Missing __all__, inconsistent naming, no type hints\n- Only vhdl/__init__.py defines __all__\n- 20+ TODO/FIXME/HACK comments in production code\n- No exception hierarchy (each module defines own exceptions)\n\n## Findings by Severity\n\n### CRITICAL (Must Fix)\n| # | Domain | Issue | Location |\n|---|--------|-------|----------|\n| 1 | Security | eval() code injection | interface.py:77, mmap/builder.py:224 |\n| 2 | Security | pickle.load() RCE | vcdevts/__init__.py:157, vcd/parser.py:194 |\n| 3 | Packaging | setup.py broken, grammar files missing | pyproject.toml, setup.py |\n| 4 | HDL | vector.py dumps() returns wrong value | vector.py:135 |\n| 5 | Architecture | Circular dependency abshdl\u2194hdllib | highlvl.py:15-21, fsm.py:14 |\n| 6 | Packaging | Unpinned dictator dependency | pyproject.toml:10 |\n\n### HIGH (Should Fix Soon)\n| # | Domain | Issue | Location |\n|---|--------|-------|----------|\n| 7 | Error Handling | 7 bare except clauses | Multiple files |\n| 8 | Testing | No CI/CD, no pytest config | Project-wide |\n| 9 | API | No exception hierarchy | Project-wide |\n| 10 | HDL | VHDL library detection heuristics fragile | vhdl/codegen.py:155-303 |\n| 11 | Architecture | 50+ duplicated methods in backends | verilog/codegen.py, vhdl/codegen.py |\n| 12 | Security | No input size limits on VCD/file parsing | streaming_parser.py, vcdevts |\n\n### MODERATE\n| # | Domain | Issue | Location |\n|---|--------|-------|----------|\n| 13 | Git | __pycache__ not in .gitignore (77 files) | .gitignore |\n| 14 | API | Only 1 module defines __all__ | vhdl/__init__.py |\n| 15 | Performance | String-based expression detection | vhdl/codegen.py |\n| 16 | HDL | AXI reset - no async reset support | hdllib/aximm.py |\n| 17 | DSL | deprecated ast.NameConstant/ast.Num usage | expr.py:230, 543 |\n| 18 | Testing | No property-based or fuzz testing | tests/ |\n\n### IMPROVEMENT\n| # | Domain | Issue | Location |\n|---|--------|-------|----------|\n| 19 | DevOps | No linting/formatting tools configured | pyproject.toml |\n| 20 | Docs | No CONTRIBUTING.md or dev setup guide | Project root |\n| 21 | API | 20+ TODO/FIXME/HACK comments | Multiple files |\n| 22 | Performance | O(n\u00b2) find_by_tag in scope | scope.py |\n| 23 | HDL | Sensitivity list missing duplicate check | sens.py:60 |\n| 24 | Packaging | Missing PyPI metadata (classifiers, etc.) | pyproject.toml |\n\n## Recommended Priority Actions\n1. Remove eval() calls \u2192 use safe expression evaluator\n2. Replace pickle.load() \u2192 use JSON or RestrictedUnpickler  \n3. Remove setup.py, add package_data to pyproject.toml\n4. Fix bare except clauses with specific exception types\n5. Pin dictator to commit hash\n6. Add __pycache__/ to .gitignore\n7. Add pytest config to pyproject.toml\n8. Create base exception class hierarchy",
    "context": "Comprehensive 10-agent codebase audit covering architecture, hardware engineering, DSL design, testing, error handling, API design, performance, security, code generation, and DevOps",
    "repository_id": "github.com/brunosmmm/hdltools",
    "session_id": 202602060126549947,
    "session_type": "Software Development",
    "title": "Comprehensive Codebase Audit - hdltools"
  },
  "entity_id": "20260206_0141_10-agent-comprehensive-codebase-audit",
  "lamport_clock": 41,
  "operation_id": "op_20260206_024536_04cc8aec",
  "operation_type": "checkpoint_save",
  "parent_operation": null,
  "timestamp": "2026-02-06T01:41:32.852792+00:00"
}